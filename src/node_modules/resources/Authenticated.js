import { Resource } from "rest-hooks";

function getCookie(name) {
  var v = document.cookie.match("(^|;) ?" + name + "=([^;]*)(;|$)");
  return v ? v[2] : null;
}

export default class AuthenticatedResource extends Resource {
  static fetchPlugin = (request: Request) => {
    return request.set({
      Accept: "application/json",
      Authorization: `Bearer ${getCookie("token")}`
    });
  };

  static detailShape(t) {
    return {
      ...super.detailShape(),
      schema: { data: this.getEntitySchema() }
    };
  }

  static listShape(t) {
    return {
      ...super.listShape(),
      schema: { data: [this.getEntitySchema()] }
    };
  }

  static createShape(t) {
    return {
      ...super.createShape(),
      schema: { data: this.getEntitySchema() }
    };
  }

  static updateShape(t) {
    return {
      ...super.updateShape(),
      schema: { data: this.getEntitySchema() }
    };
  }
}
